﻿@{
    ViewBag.Title = ViewData["ViewBagTitle"];
    Layout = "~/Views/Shared/GeneralFormMaster.cshtml";
}

@*<script src="@Url.Content("~/Scripts/jit.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/Spacetreebase.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/bootstrap.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/Spacetree.css")" rel="stylesheet" type="text/css" />*@


@*<link href="@Url.Content("~/Content/bootstrap/bootstrap.css")" rel="stylesheet" type="text/css" />*@
@*<link href="@Url.Content("~/Content/organization.css")" rel="stylesheet" type="text/css" />*@
@*<link href="@Url.Content("~/Content/orgtree.css")" rel="stylesheet" type="text/css" />*@
@*<link href="@Url.Content("~/Content/plusMinus/iconfont.css")" rel="stylesheet" type="text/css" />*@

<link href="../../../../../Content/orgtree.css" rel="stylesheet" type="text/css" />
<link href="../../../../../Content/plusMinus/iconfont.css" rel="stylesheet" type="text/css" />
<style type="text/css">
    .mylable {
        font-size: 12pt;
        color: White;
    }`SDFGHJ?VCX

    .div_shadow {
        border: #909090 5px solid;
        background: #fff;
        color: #333;
        -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#000000')"; /* For IE 8 */
        filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#000000'); /* For IE 5.5 - 7 */
        -moz-box-shadow: 2px 2px 10px #909090; /* for firefox */
        -webkit-box-shadow: 2px 2px 10px #909090; /* for safari or chrome */
        box-shadow: 2px 2px 10px #909090; /* for opera or ie9 */
    }

    #center-container {
        background-color: #EDF0F2;
        color: #000000;
    }

    #infovis label {
        margin-bottom: 0px !important;
        line-height: 15px;
    }

    #infovis, #infovis-canvaswidget {
        /*background-color: #edf1f4;*/
        width: 700px;
    }

        #infovis .node {
            border-radius: 2px;
            padding-top: 0px;
        }

        #infovis .node-1 {
            width: 100px;
            height: 220px;
            background: #F8F7E4;
            border-radius: 5px;
            border: 1px solid #ccc;
            position: relative;
            box-shadow: 0px 1px 3px rgba(0,0,0,.3);
            font-size: 12px;
            font-family: Arial;
        }

        #infovis .node table td {
            text-align: left;
            padding-left: 2px;
        }


    #dvright {
        height: 200px;
        z-index: 1;
        background-color: transparent;
        position: fixed;
        top: 80px;
        right: 30px;
    }

    .panel-heading {
        padding: 5px 5px 5px 5px;
    }

    .panel-body {
        padding: 5px;
    }

    .panel-title {
        font-size: 12px;
    }

    .panel-body {
        padding: 10px;
    }

    .padding1 {
        padding-right: 5px;
        padding-left: 5px;
    }

    #dvData {
        line-height: 1;
    }

    .span-2 {
        line-height: 16px;
    }

    .title:hover {
        height: 200px;
    }

    .title {
        padding: 5px 3px;
        display: block;
        line-height: 15px;
        overflow: hidden;
        transition: all 1s;
        height: 36px;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }

        .title span {
            display: block;
            background: #F8F7E4;
            padding-bottom: 5px;
        }

    .detail {
        margin: 5px; /*position: absolute;*/
        top: 36px;
        left: 0;
        display: block;
    }

    .namecard {
        color: #000;
        font-weight: bold;
        height: 20px;
        line-height: 20px;
        text-align: center;
    }

    .photo {
        width: 78px;
        height: 95px;
        background: #ccc;
    }

    .dept {
        padding: 5px;
        display: block;
        overflow: hidden;
        transition: all 1s;
        height: 53px;
        width: 100%;
        position: absolute;
        bottom: 1px;
        left: 0;
        z-index: 2;
    }

        .dept:hover {
            height: 100px;
            background: #ccc;
        }

    body {
        background-image: none;
        overflow:auto;
       
        position:relative;
    }

    .dept {
        height: 30px;
    }

    .detail {
        position: absolute;
    }

    .dvbox {
        border: 1px solid Black;
        text-align: center;
        width: 20px;
        height: 20px;
        top: 0;
        left: 0;
        position: absolute;
    }

    .dvbox1 {
        border: 1px solid Black;
        text-align: center;
        width: 20px;
        height: 20px;
        top: 0;
        right: 0;
        position: absolute;
    }

    .dvbox2 {
        border: 1px solid Black;
        text-align: center;
        width: 20px;
        height: 20px;
        top: 0;
        right: 20px;
        position: absolute;
        border-right: none;
    }

    .dvname {
        text-align: center;
        width: 100%;
        height: 15px;
        line-height: 15px;
        overflow: hidden;
        background-color: #32cd32;
        vertical-align: bottom;
        font-size: 8px;
    }

    table.righttable td {
        border: 1px solid red;
        width: 20px;
        gn: expression(this.onselectstart=function(){return false;});
        -moz-user-select: none;
    }

    /**新加*/
    body, html {
       background:#EDF1F4;
    }
    body, html,div,li,ul,i {
        padding:0;
        margin:0;
    }
    body {
        -moz-user-select: none;
        -o-user-select: none;
        -khtml-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none; /**禁止选中文字*/
    }
    /**缩放按钮*/
    .mark {
        z-index: 2;
        position: relative;
        float: right;
        background: #EDF1F1!important;
        display: inline-block;
    }

        .mark .minus {
            padding-left: 5px;
        }

    #dvModel {
        padding: 0;
        
        float:none;

    }

        #dvModel table {
            position: relative;
            background: #fff;
            width:570px;
        }

    #dvright {
        z-index: 3;
    }

    #dvData {
        position: relative;
        left: -20px;
        top: -53px;
    }

    #info {
        position: relative;
        z-index: 2;
    }

    #info {
      
       
        z-index: 2;
    }

        #info .left, #info .right {
            display: inline-block;
            border: 1px solid #000;
            padding: 5px;
        }

        #info .left {
            background: rgb(59,166,191)!important;
            color: #fff;
        }

        #info .right {
            background: #fff!important;
        }

    .btn.pull-right {
        position: relative;
        z-index: 3;
        top: 2px;
    }

    .orgWrap {
        top: 30px;
    }
    /**表格放大缩小*/
    .btnWrap {
      position:absolute;
      right:0;
      top:-25px;
    }

        .btnWrap .btn {
            float: none!important;
        }

        .btnWrap i {
            cursor: pointer;
            z-index: 3;
            color: #000;
        }

    /*#dvModel {
        transform-origin:0 100%;
        -webkit-transform-origin:0 100%;
        -moz-transform-origin:0 100%;
        -o-transform-origin:0 100%;
        -os-transform-origin:0 100%;
    }*/

        #dvModel {
        transform-origin:100% 0;
        -webkit-transform-origin:100% 0;
        -moz-transform-origin:100% 0;
        -o-transform-origin:100% 0;
        -os-transform-origin:100% 0;
    }

    .mark i {
        color: #000;
    }

    .mark {
       
        margin-left: 10px;
        line-height: 30px;
        height: 30px;
        
    }

    .btnWrap {
        visibility:hidden;
    }
        /*按钮文字大小**/
        .mark i, .btnWrap i {
            font-size: 17px;
            color:#a9a9a9;
        }

    #tableWrap {
        position: relative;
        left: 0;
        top: 0;
    }

    /*content修改样式*/
   #infovis .orgWrap .content {
        font-family:'Microsoft YaHei';
        border:3px solid #000;
        border-radius:2px;
        box-shadow: 3px 3px 3px #888888;
        position:relative;
        color:#000;
    }

    /*table样式修改*/
    #dvModel table {
        font-size:12px;
    }
    #dvModel table td {
        border:1px solid #a9b7b7 ;
        padding: 1px;
        text-align: center;
        min-width: 12px;
    }
        #dvModel table tr:nth-child(odd) {
            background:#f5f8fd;
        }
    /**loading样式*/
 
    
    #lenloading {
        position:fixed;
        left:0;top:0;right:0;bottom:0;
        display:none;
        text-align:center;
        line-height:100vh;
        z-index:99;
    }
    /**初始时缩放*/
    #dvModel,.orgWrap {
        transform:scale(0.85);
        -moz-transform:scale(0.85);
        -o-transform:scale(0.85);
        -ms-transform:scale(0.85);
        -webkit-transform:scale(0.85);
    }
    /*简单页面第一层*/
    .simple .level1 .content .up {
        position:relative;
        top:11px;
    }

   
    /*修改打印偏移*/
    #dvright {
        position:absolute;
    }
     #dvData {
        position:absolute;
    }
    #tableWrap,.orgWrap {
      
    }

    /*smallContent*/
    .smallContent{  
        border:none;
       height: 21px;
       width:20px;
       }
       
  .smallContent>*{
       visibility:hidden;
    }
    .level1 .smallContent > * {
        visibility:visible;
    }

   .smallContent>.icon {
         visibility:visible;
        display:inline-block;
         
    }

    /*第二层*/
    .level2>.smallContent{ 
        border:3px solid #000;   
        height: 21px;
        width: 20px!important;
        border:none!important;
        height:0;
       }
        .level2 > .smallContent #icon {
            left:-4px;
        }


   /*.level2>.smallContent > .icon {
            border:none;
        }*/

 /*icon隐藏没有子节点*/

    #infovis .smallContent.iconHidden {
        border:none;
        box-shadow:none;
        background:none;
        width:170px!important;
       
    }
    .iconHidden #icon::before{
        content:'';
    }
    #infovis .smallContent.iconHidden  #icon {
        width:20px;
        height:20px;
        border:3px solid #000;
         
        background:#fff;
    }
    #dvModel {
      
        visibility:hidden;
    }
   #dvModel .dvinner {
         box-shadow:0 0 10px #000;
         background: #fff
        }


    /**IE*/
     #info{
    
    }
    .mark{
     
     
      margin-left:40px;
    }
    .level2s .level2 .smallContent::before {
        left:1px;
        top:-36px;
    }



    /*第二层小图标特殊样式*/
    .level2 .smallContent #icon {
        /*transform:rotate(45deg);
        -o-transform:rotate(45deg);
        -ms-transform:rotate(45deg);
        -moz-transform:rotate(45deg);
        -webkit-transform:rotate(45deg);*/
        color:#000;
        font-size: 14px;
        left: -5px;
       
    } 

    /**copyright*/
    #AssemblyVersionDiv,#ps_alert {
        display:none;
    }
    
    /**默认缩小*/





 .orgWrap .content .bottom>div {
    border-top: 1px dotted #a9a9a9;
    background: #38de29;
    height: 22px;
    line-height: 22px;
}

 /***/
    #infomark {
        position:fixed;
        width:100%;
        left:20px;
        top:30px;
        z-index:5;
        transform:translateY(0);
        -o-transform:translateY(0);
        -ms-transform:translateY(0);
        -moz-transform:translateY(0);
        -webkit-transform:translateY(0);
    }

    #infomark > div {
        float:left;
        }
    #approval {
        z-index:4;
        position:fixed;
        bottom: 100px;
        right: 200px;
        transform:scale(1);
        -o-transform:scale(1);
        -ms-transform:scale(1);
        -moz-transform:scale(1);
        -webkit-transform:scale(1);
    }

        /**ie*/
    .hasSmallContent > .level3s {
       margin-top:-16px\9;
    }

    .approval3>div{
            font-size: 16px;
           
            line-height: 50px;
    }
    
    /**打印设置*/
    #lenPrint {
        position:absolute;
        right:100px;

    }
   #lenPrint input {
       padding:2px;
       border-radius:2px;
   }

   /*approval3*/
    .approval3 {
        position:absolute;
        top:190mm;
        left:330mm;
        z-index:4;
        visibility:visible;
        border: 3px solid rgb(0, 0, 0);
        width: 340px;
        padding: 0px 20px 20px;
    }

    .infoinner {
        height:99vh!important;
    }
    html {
        width:550mm;
        height:20px;
       
    }
    .orgWrap .level2 {
        padding-right:10px;
    }
    .orgWrap .level22 {
         padding-right:20px;
    }
    
</style>
<!--[if IE]>
<style>


</style>
<![endif]-->



<div id="infomark">
   <div id="info">
     <div class="left" title="蓝色背景为岗位">岗位单元</div>
     <div class="right" title="白色背景为组织">组织单元</div>
   </div>
   <div class="mark">
    <span class="plus "><i class="glyphicon glyphicon-zoom-in" title="架构图放大"></i></span>
    <span class="minus "><i class="glyphicon glyphicon-zoom-out" title="架构图缩小"></i></span>
    <span><i class="glyphicon glyphicon-list-alt" onclick="showtable()" title="显示/隐藏表格"></i></span>
</div>
       
   <div id="lenPrint">
    <input value="打印预览" type="button" class="print" onclick="javascript: window.print()" />
    <OBJECT classid="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2" height="0" id="wb" name="wb" width="0">
    </OBJECT>
    <input type=button name="button_show" value="打印预览" class="printShow" onclick="javascript: wb.execwb(7, 1);" />
   </div>
</div>





<div class="pagewrap">
    <div id="dvData">
    <div class="jiagou"><span id="name"></span><span>组织机构图</span></div>
    <div class="row" id="dvright" data-bind="visible:$root.Showright()">
        <div id="tableWrap" >
            <div class="btnWrap" >
                <i class="glyphicon glyphicon-zoom-in plus" title="表格放大"></i>
                <i class="glyphicon glyphicon-zoom-out minus" title="表格缩小"></i>
            </div>
            <div class="col-xs-12 padding1" id="dvModel" data-bind="visible:$root.Showright()">
                <div class="dvinner">
                     <table class="righttable">
                    <thead>
                        <tr>
                            <td style="width: 130px">科室/区域(在岗数)
                            </td>
                            <td>A
                            </td>
                            <td>B
                            </td>
                            <td>C
                            </td>
                            <td>D
                            </td>
                            <td>E
                            </td>
                            <td>F
                            </td>
                            <td>G
                            </td>
                            <td>H
                            </td>
                            <td>I
                            </td>
                            <td>J
                            </td>
                            <td style="width: 50px">管理层
                            </td>
                            <td style="width: 40px">其他
                            </td>
                            <td style="width: 40px">总计
                            </td>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach:RightTable1">
                        <tr>
                            <td data-bind="text:Name"></td>
                            <td data-bind="text:ColumnA"></td>
                            <td data-bind="text:ColumnB"></td>
                            <td data-bind="text:ColumnC"></td>
                            <td data-bind="text:ColumnD"></td>
                            <td data-bind="text:ColumnE"></td>
                            <td data-bind="text:ColumnF"></td>
                            <td data-bind="text:ColumnG"></td>
                            <td data-bind="text:ColumnH"></td>
                            <td data-bind="text:ColumnI"></td>
                            <td data-bind="text:ColumnJ"></td>
                            <td data-bind="text:ColumnManager"></td>
                            <td data-bind="text:ColumnOther"></td>
                            <td data-bind="text:ColumnTotal"></td>
                        </tr>
                    </tbody>
                </table>
                     <table class="righttable" style="margin-top: 30px">
                    <thead>
                        <tr>
                            <td style="width: 130px">科室/区域(编制数)
                            </td>
                            <td>A
                            </td>
                            <td>B
                            </td>
                            <td>C
                            </td>
                            <td>D
                            </td>
                            <td>E
                            </td>
                            <td>F
                            </td>
                            <td>G
                            </td>
                            <td>H
                            </td>
                            <td>I
                            </td>
                            <td>J
                            </td>
                            <td style="width: 50px">管理层
                            </td>
                            <td style="width: 40px">其他
                            </td>
                            <td style="width: 40px">总计
                            </td>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach:RightTable2">
                        <tr>
                            <td data-bind="text:Name"></td>
                            <td data-bind="text:ColumnA"></td>
                            <td data-bind="text:ColumnB"></td>
                            <td data-bind="text:ColumnC"></td>
                            <td data-bind="text:ColumnD"></td>
                            <td data-bind="text:ColumnE"></td>
                            <td data-bind="text:ColumnF"></td>
                            <td data-bind="text:ColumnG"></td>
                            <td data-bind="text:ColumnH"></td>
                            <td data-bind="text:ColumnI"></td>
                            <td data-bind="text:ColumnJ"></td>
                            <td data-bind="text:ColumnManager"></td>
                            <td data-bind="text:ColumnOther"></td>
                            <td data-bind="text:ColumnTotal"></td>
                        </tr>
                    </tbody>
                </table>
                </div>
            </div>
  
           @*  <div class="approval2">
                 <div>编制：</div>
                 <div>审核：</div>
                 <div>批准：</div>

             </div>*@
        </div>
    </div>
    <div style="background-color: #edf1f4; width: 100%">

        <div class="row">
            <div class="col-xs-12">
                <div id="center-container">
                    <div id="infovis">
                        @* 新的组织架构图 *@
                        <div class="infoinner">
                                <div class="orgWrap" id="orgWrap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="approval3">
                 <div>编制：</div>
                 <div>审核：</div>
                 <div>批准：</div>
                 <div id="showTime">
                     <span>日期:</span>
                     <span class="showT"></span>
                 </div>
             </div>
</div>
</div>
<input type="button" id="btnUp" style="display: none" />

 <div id="lenloading"><img src="/Content/images/loading.gif"/></div>


<script type="text/javascript">



    var isreadrighttable = false;

    ///画布大小

    document.getElementById("infovis").style.width = $(window).width() + "px";
    document.getElementById("center-container").style.width = $(window).width() - 30 + "px";

    document.getElementById("infovis").style.height = $(window).height() + "px";
    $('#infovis').css('height', '1px')

    var uHeight = 80;
    var uWidth = 180;

    var labelType, useGradients, nativeTextSupport, animate;

    (function () {
        var ua = navigator.userAgent,
          iStuff = ua.match(/iPhone/i) || ua.match(/iPad/i),
          typeOfCanvas = typeof HTMLCanvasElement,
          nativeCanvasSupport = (typeOfCanvas == 'object' || typeOfCanvas == 'function'),
          textSupport = nativeCanvasSupport
        && (typeof document.createElement('canvas').getContext('2d').fillText == 'function');
        //I'm setting this based on the fact that ExCanvas provides text support for IE
        //and that as of today iPhone/iPad current text support is lame
        labelType = (!nativeCanvasSupport || (textSupport && !iStuff)) ? 'Native' : 'HTML';
        nativeTextSupport = labelType == 'Native';
        useGradients = nativeCanvasSupport;
        animate = !(iStuff || !nativeCanvasSupport);
    })();


    $(function () {
        rightModel.ApplyBinding();
    });

    var json1;
    var rightTable1;
    var rightTable2;
    $.ajax({
        type: "Get",
        url: "../HCMTree/GetOrgUnitChart",
        data: { unitId: '@Request.QueryString["unit"]', issimple: '@Request.QueryString["issimple"]' },
        dataType: "json",
        "async": false,
        cache: false,
        success: function (m) {
            json1 = m;
            //console.log(JSON.stringify(json1));
            console.log(json1);
            //rightTable1 = m[1];
            //rightTable2 = m[2];
        },
        error: function (n) {
            alert(n.responseText);
        }
    });

    function GetRightTable() {
       
        if (!isreadrighttable) {
            $.ajax({
                type: "Get",
                url: "../HCMTree/GetRightTable",
                data: { unitId: '@Request.QueryString["unit"]' },
                dataType: "json",
                "async": false,
                cache: false,
                success: function (m) {
                    rightModel.RightTable1(m[0]);
                    rightModel.RightTable2(m[1]);
                    $('#lenloading').css('display', 'none')
                    isreadrighttable = true;
                   
                    
                },
                error: function (n) {
                    alert(n.responseText);
                }
            });
        }
    }



    function saveImage() {
        var mycanvas = document.getElementById("infovis-canvas");
        var image = mycanvas.toDataURL("image/png");
        var w = window.open("about:blank,image from canvas");
        w.document.write("<img src=" + image + " alt=from canvas/>");
        //        var canvas = document.getElementById("infovis-canvas");
        //        var image = canvas.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream");
        //        //window.location.href = image;
        //        window.open(image);
        //        //window.open(canvas.toDataURL("image/jpeg"));
    }

    function CheckImgExists(imgV, staffno) {
        var ImgObj = new Image(); //判断图片是否存在 
        var imgurl = '../../Photos/' + staffno;
        var AllImgExt = ".png|.jpg|.jpeg|.bmp|.gif|"; //全部图片格式类型
        var srcI = imgV.src;
        var item = AllImgExt.split('|');
        var imgT = srcI.substr(srcI.lastIndexOf('.')).toLowerCase();
        switch (imgT) {
            case item[0]:
                imgV.src = imgurl + item[1];
                break;
            case item[1]:
                imgV.src = imgurl + item[2];
                break;
            case item[2]:
                imgV.src = imgurl + item[3];
                break;
            case item[3]:
                imgV.src = imgurl + item[4];
                break;
            default:
                imgV.src = '/Photos/nophoto.png';
                break;
        }
    }

    var rightModel = new function () {
        var self = this;
        self.RightTable1 = ko.mapping.fromJS(rightTable1);
        self.RightTable2 = ko.mapping.fromJS(rightTable2);
        self.ApplyBinding = function () {
            ko.applyBindings(self, document.getElementById("dvModel"));
        }
        self.Showright = ko.observable(false);
    }
    
    function showtable() {
        if (rightModel.Showright()) {
            rightModel.Showright(false);
            $('.btnWrap').css('visibility', 'hidden')
            $('.approval').css('visibility', 'hidden')
            $('.approval3').css('display','none')
        } else {
            rightModel.Showright(true);
            $('.approval3').css('display', 'block')
            $('.approval').css('visibility', 'visible')
           
            $('.btnWrap').css('visibility', 'visible')
            GetRightTable();

        }
    }

    function showDetail(id) {
        window.open("../../Organization/HCMTree/Index?unit=" + id, "_blank");
    }


</script>
<script type="text/javascript">

    //时间显示
    function showTime() {
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth()+1;
        var day = now.getDate();
        var hours = now.getHours();
        var minutes = now.getMinutes();
        var seconds = now.getSeconds();
        timeHtml = "" + year + "年" + month + "月" + day + "日 ";
        $('#showTime').children('.showT').text(timeHtml);
       
    }

    function checkTime(str) {
        if (parseInt(str) < 10) {
            return "0" + str;
        } else {
            return str;
        }

    }
    setInterval(showTime, 500);
    
    var loadingFlag = true;
    $(document).on('click', '.glyphicon-list-alt', function () {
        if (loadingFlag) {
            $('#dvModel').css('visibility', 'visible')
           

        }
        loadingFlag = false;
     })

   
    
  

    //放大缩小功能
    var scale = 0.85;
   
    $('.mark').on('click', '.plus', function () {
        if (scale <= 1.5) {
            scale += 0.1;
            $('.orgWrap').get(0).style.webkitTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.mozTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.msTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.oTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.transform = "scale(" + scale + ")";
        }
    });
    $('.mark').on('click', '.minus', function () {
        if (scale >= 0.5) {
            scale -= 0.1;
            $('.orgWrap').get(0).style.webkitTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.mozTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.msTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.oTransform = "scale(" + scale + ")";
            $('.orgWrap').get(0).style.transform = "scale(" + scale + ")";
        } else {
            /* alert('不能再缩小了')*/
        }
    });
    //表格放大缩小功能
    var scale1 = 0.85
    
    $('.btnWrap').on('click', '.plus', function () {
       
        if (scale1 <= 1.5) {
            scale1 += 0.1;
            $('#dvModel').get(0).style.webkitTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.mozTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.msTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.oTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.transform = "scale(" + scale1 + ")";

           // $('.approval2').get(0).style.webkitTransform = "scale("+1/scale1+")";
        }
    });
    $('.btnWrap').on('click', '.minus', function () {
        if (scale1 >= 0.5) {
            scale1 -= 0.1;
            

            $('#dvModel').get(0).style.webkitTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.mozTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.msTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.oTransform = "scale(" + scale1 + ")";
            $('#dvModel').get(0).style.transform = "scale(" + scale1 + ")";


            //$('.approval2').get(0).style.webkitTransform = "scale(" + 1 / scale1 + ")";
        } else {
            /* alert('不能再缩小了')*/
        }
    });
    //len加组织架构图
    var simple = '@Request.QueryString["issimple"]';
    var levelToshow = '@Request.QueryString["level"]';
    var index = 3;//显示层级
    renderList(json1);
    function renderList(obj) {
        if (simple != 0) {
            $('.orgWrap').addClass('simple');
        }
        //第一层
        var level1s = '<div class="level1s"><div class="level1"><div class="content"></div></div></div>';
        var $level1s = $(level1s);
        var devider = '<div class="divider"></div>';
        var $devider = $(devider);
        var level2s = '<ul class="level2s"></ul>';
        var $level2s = $(level2s);

        if (obj.data.UnitName) {
            $('.jiagou').find('#name').text(obj.data.UnitName)
        }else{
            $('.jiagou').css('display', 'none');
        }

       


        if (obj.data) {
            renderData(obj, $level1s.find('.content'))
        }
        $('.orgWrap').append($level1s);
        $('.orgWrap').append($devider);
        var level2length = 0; //第二层数量
        if (obj.children.length) {
            //第二层
            $.each(obj.children, function (item, value) {
                level2length++;
                var level2 = '<li class="level2"><div class="content"></div></li>';
                var $level2 = $(level2);
                if (value.data) {
                    renderData(value, $level2.find('.content'));
                }
                index = 3;
                //第三层
                renderLevel3(value, $level2, $level2s);

                if (value.children.length) {
                }
            })
            if (level2length == 1) {
                $('.orgWrap').attr('id', 'oneChild')
            } else if (level2length == 2) {
                $('.orgWrap').attr('id', 'twoChild')
            } else if (level2length == 0) {
                $('.orgWrap').attr('id', 'noneLevel2')
            }
        } else {
            $('.orgWrap').attr('id', 'noneLevel2')
        }

        $('.orgWrap').append($level2s);
    }

    //三层以后
    function renderLevel3(obj, $level, $levels) {
        
        var level3s = '<ul class="level' + index + 's"></ul>';
        var level3 = '<li class="level' + index + '"><div class="content"></div></li>';
        var $level3s = $(level3s);

        if (index == 3) {
            $level3s.addClass('tree')
        }
        //区分岗位与组织架构
        if (obj.data.Type == '2' && obj.children.length) {
            index++;

            $.each(obj.children, function (item, value) {

                var $level3 = $(level3);/*错*/

                if (value.data) {
                    renderData(value, $level3.find('.content'))
                }

                if (value.data.UnitName == '-') {
                    console.log('-');
                } else {
                    $level3s.append($level3);
                }

                if (value.children && value.data.UnitName != '-') {
                    renderLevel3(value, $level3, $level3s);
                }

            });

        } else if (obj.children.length && index <= levelToshow) {
            index++;

            $.each(obj.children, function (item, value) {

                var $level3 = $(level3);/*错*/

                if (value.data) {
                    renderData(value, $level3.find('.content'))
                }
               
                if (value.data.UnitName=='-') {
                    console.log('-');
                } else {
                    $level3s.append($level3);
                }
               
                if (value.children && value.data.UnitName!='-') {
                    renderLevel3(value, $level3, $level3s);
                }

            });

        }





        $level.append($level3s);
        $levels.append($level)

    }  /*renderLevel3结束*/



    //循环data
    function renderData(value, dom) {

        var icon = '<i class="icon icon-minus-sign" id="icon"></ic>'
        var $icon = $(icon);
        
        var left = '<i class="left">&nbsp;&nbsp;</i>';
        var right = '<i class="right"><i class="dv1">&nbsp;&nbsp;</i><i class="dv2">&nbsp;&nbsp;</i></i>';
        var $left = $(left);
        var $right = $(right);
        if (value.data.PostLevel) {
            $left.text(value.data.PostLevel);
        }
        if (simple != '1') {
            if (value.data.ActualCount) {
                $right.find('.dv2').text(value.data.ActualCount);
            } else {
                $right.find('.dv2').text('0');
            }
        }
        if (value.data.HeadCount) {
            //复杂页面
            $right.find('.dv1').text(value.data.HeadCount);
        }
        var staffNames = value.data.StaffNames ? value.data.StaffNames : '';
        var middle = '<div class="middle" title="' + staffNames + '"><div class="up">&nbsp;&nbsp;</div><div class="down">&nbsp;&nbsp;</div></div>'
        var $middle = $(middle);
        if (value.data.UnitName) {
            $middle.find('.up').text(value.data.UnitName);
        }
        //smallContent;
        if (value.data.UnitName=='-') {
            dom.addClass('smallContent');
        }
        if (value.data.PositionName) {
            $middle.find('.down').text(value.data.PositionName);
        }

        //$middle.find('.up').attr('ondblclick', 'shownext("' + value.data.UnitLevel + '","' + value.id + '","' + value.data.UnitLevel + '")');

        dom.append($left);
        dom.append($right);
        dom.append($middle);
        var bottom = '<div class="bottom"></div>';
        var $bottom = $(bottom);
        //复杂页面
        if (simple == '0') {
            
            if (value.data.Staffs.length) {
                dom.addClass('hasList');
                $.each(value.data.Staffs, function (key, value) {
                    var list = '<div class="list"></div>';
                    var $list = $(list);
                    $list.text(value.StaffName + '(' + value.PostLevel + ')');
                    $bottom.append($list);
                });
            }


            if (value.data.Vacancies != 0) {
                var TBD = '<div class="TBD"></div>';
                var $TBD = $(TBD);
                $TBD.text('TBD (' + value.data.Vacancies + ')');
                $bottom.append($TBD);
            }
        }
        dom.append($bottom);

        dom.append($icon)

        //添加不同背景颜色
        if (value.data.Type == '2') {
            dom.addClass('yellow');
            dom.find('.up').css('display', 'none')

        } else {
            dom.find('.middle').attr('ondblclick', 'shownext("' + value.data.UnitLevel + '","' + value.id + '","' + value.data.UnitLevel + '")');
            dom.find('.down').css('display', 'none')
            
            if (value.data.UnitName == '-') {
                dom.attr('ondblclick', 'shownext("' + value.data.UnitLevel + '","' + value.id + '","' + value.data.UnitLevel + '")');


            }

        }
        if (value.data.UnitLevel == '15') {
            var check = '<i class="check">明细</i>'
            var $check = $(check);
            //dom.find('.lvl-b').append($check);
        }

    }


    //第三层
    $('.level3').children('.smallContent').each(function () {
        $(this).parent('.level3').css('display', 'none');

    })

    function shownext(level, id, level) {
        if (level == "15" || level == "18" || level == "21") {
            window.open("../../Organization/HCMTree/UnitIndex?level=6&issimple=" + simple + "&unit=" + id, "_blank");
        }
        else {
            window.open("../../Organization/HCMTree/UnitIndex?level=3&issimple=" + simple + "&unit=" + id, "_blank");
        }
    }
</script>
<script type="text/javascript">
    
    //修改白色背景
    $(function () {
        $('#clickSession').siblings().each(function () {
            if ($(this).css('opacity') == '0.95') {
                $(this).css('background', '#ECF1F4');
            }
        })
    })

    $(function () {
        $('body').children('div').each(function () {
           
                $(this).css('background', '#ECF1F4');
            
        })
    })
    

    /*防止第二层折行*/
    $(function () {
        
        var $level2 = $('.level2s').children('.level2');

        var _width = parseInt($level2.width());
        var maxHeight = $level2.height();
        var maxWidth = $level2.width();
        var allWidth = 0;/*累加第二层宽度*/


        /*第二层最后一个*/
        var lastlevel2 = $('.level2:last-child');
        var lastWidth = parseInt(lastlevel2.css('width'));
        var lastLevel2content = lastlevel2.children('.content').find('.up').text();
        var level2Size = $('.level2s .level2').size() - 1;/*第二层数量-1*/

        /*js获取元素属性兼容*/
        function getStyle(obj, attr) {
            if (obj.currentStyle) {
                return obj.currentStyle[attr];
            } else {
                return getComputedStyle(obj, false)[attr];
            }
        }
        if (lastLevel2content == '-') {
           
            $('.level2:nth-child(' + level2Size + ')').css('padding-right',parseInt(maxWidth)-160+'px')
        }


        $level2.each(function () {
            //第二层特别小图标
            $(this).children('.smallContent').children('.icon').removeClass('icon-minus-sign').addClass('iconfont icon-jianhao  icon2')
            if ($(this).children('.smallContent').size()) {
               
                if (!$(this).find('.bottom').children('div').size()) {
                   
                    $(this).addClass('hasSmallContent');
                }
               
            }

            if (!$(this).find('li.level3').size()) {
                $(this).addClass('noneChild')
            }
            //$(this).css('padding-right','10px')
            var _height = $(this).height();
            var _width = $(this).width();
            allWidth += $(this).outerWidth(true);

            //var left = 0;
            //for (var i = 0; i < $(this).index() ; i++) {
            //    var contentWidth = parseInt(window.getComputedStyle($level2[i]).width);
            //    var paddingLeft = parseInt(window.getComputedStyle($level2[i]).paddingLeft);
            //    var paddingright = parseInt(window.getComputedStyle($level2[i]).paddingRight);
            //    width = contentWidth + paddingLeft + paddingright;
            //    left += width;

            //}
            /*向右堆叠*/
            $(this).css('left', allWidth - $(this).outerWidth(true));
            if (_height >= maxHeight) {
                maxHeight = _height;
            }
            if (_width >= maxWidth) {
                maxWidth = _width;
            }
        });
        /*保持同高*/
        $level2.css('height', maxHeight);
        $level2.parent('.level2s').css('height', maxHeight);
        //$('html').css('height',maxHeight+50)
        /*为没有子节点的第二层添加右padding*/

        
       
        
        if (lastLevel2content == '-') {
            /*第二层倒数第二个*/
            $('.level2:nth-child(' + level2Size + ')').addClass('level22');
           
            /*第二层第一个*/
            var firstlevel2 = $('.level2:first-child');
            var firstcontentwidth = parseInt(firstlevel2.children('.content').outerWidth(true));

            lastlevel2.children('.content').addClass('smallContent');
            
            $('.divider').css('left', firstcontentwidth/2);
            $('.divider').css('width', allWidth - lastWidth - firstcontentwidth / 2);
            
            $('.divider').css('margin-left', 1);
           
            
            


        } else {
            $('.divider').css('left', parseInt($level2.find('.content').css('width')) / 2);
            $('.divider').css('width', allWidth - lastWidth);
            $('.divider').css('margin-left', 1);
        }
       
       
        /*防止第二层折行*/
        $('.level2s').css('width', allWidth + 10);
        $('.orgWrap').css('width', allWidth + 10);
        $('.orgWrap').css('margin-left', -allWidth / 2 - 5);
    })
    /*网页拖拽*/
    function drag(obj) {
        var dragEle = $(obj);
        var _move = false;//移动标记
        var _x, _y;//鼠标离控件左上角的相对位置
        dragEle.click(function () {
            //alert("click");//点击（松开后触发）
        }).mousedown(function (e) {
            _move = true;
            _x = e.pageX - parseInt(dragEle.css("left"));
            _y = e.pageY - parseInt(dragEle.css("top"));
            // dragEle.fadeTo(20, 0.9);//点击后开始拖动并透明显示
        });
        $(document).mousemove(function (e) {
            if (_move) {
                var x = e.pageX - _x;//移动时根据鼠标位置计算控件左上角的绝对位置
                var y = e.pageY - _y;
                dragEle.css({ top: y, left: x });//控件新位置
            }
        }).mouseup(function () {
            _move = false;
            //dragEle.fadeTo("fast", 1);//松开鼠标后停止移动并恢复成不透明
        });
    }
    drag('.orgWrap');
    drag('#tableWrap');
    drag('.approval3');

</script>
<!--点击事件-->


<script type="text/javascript">
    $(function () {
        //没有子节点不显示icon
        $('.orgWrap').find('li').each(function () {
           
            if (!$(this).find('li').size()) {
                
                $(this).find('.content').addClass('iconHidden');
                
            }
        })


        

       
        //第二层点击
        $('.level2 .smallContent .icon2').on('click', function (e) {
            var children = $(this).parents('li.parent_li').find(' > ul > li');
            if (children.is(":visible")) {
                children.hide('fast');
               
                $(this).removeClass().addClass('icon iconfont icon-jiahao').attr('title', '展开子节点');
            } else {
                children.show('fast');
                
                $(this).removeClass().addClass(' icon iconfont icon-jianhao').attr('title', '收回子节点');
            }
            e.stopPropagation;
        })



        //点击收缩展示
       
        $('.orgWrap li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Collapse this branch');
        $('.orgWrap li.parent_li > .content .icon').attr('title', '收回子节点')

        $('li>.content #icon:not(.icon2)').on('click', function (e) {

            var children = $(this).parent('.content').parent('li.parent_li').find(' > ul > li');
            if (children.is(":visible")) {
                children.hide('fast');
                $(this).attr('title', '展开子节点').addClass('icon-plus-sign').removeClass('icon-minus-sign');
               
            } else {
                children.show('fast');
                $(this).attr('title', '收回子节点').addClass('icon-minus-sign').removeClass('icon-plus-sign');
                
            }
            e.stopPropagation;
        });
    });
</script>
